!function(t){function e(i){if(a[i])return a[i].exports;var s=a[i]={exports:{},id:i,loaded:!1};return t[i].call(s.exports,s,s.exports,e),s.loaded=!0,s.exports}var a={};return e.m=t,e.c=a,e.p="",e(0)}([function(t,e,a){t.exports=a(1)},function(t,e,a){function i(t,e){if(t&&e){var a=t.lastIndexOf("."),i=t.slice(a),s=t.slice(0,a),o=s+"!"+e+"x"+e+i;return o}}a(2),MI.namespace("buyChoose"),MI.buyChoose=function(){var t={packageData:null,stockData:null,lastStepNum:0,packageResult:{},insuranceResult:{},stepActiveClass:"active",stepLockClass:"lock",stepDisableClass:"disable",proFullName:""},e=function(){return alert("参数错误!"),location.href=MI.GLOBAL_CONFIG.itemSite+"/buyphone/",!1},a=function(){window.chooseConfig&&window.chooseConfig.phone_type?($("#J_navBar").find(".J_item[data-pro="+window.chooseConfig.phone_type+"]").addClass("current").siblings().removeClass("current"),s()):e()},s=function(){return window.chooseConfig&&window.chooseConfig.version_data?void o(window.chooseConfig.version_data):e()},o=function(a){if(!a)return e();if(a.href_url&&$("#J_proMore").removeClass("hide").attr("href",a.href_url),$("#J_proImg").attr({src:a.img,alt:a.title}),$(".J_proDesc, #J_headerBarDesc").html(a.desc),a.price_min&&a.price_max){var i=a.price_min+"元";a.price_min<a.price_max&&(i+="起"),$(".J_proPrice").html(i)}t.proFullName=a.title,t.packageData=window.chooseConfig.package_data,n(),r(a),c()},n=function(){$.ajax({url:window.orderapi+"/stock/goods?gids="+window.chooseConfig.opensell_ids.join(","),dataType:"jsonp",jsonp:"jsonpcallback"}).done(function(e){t.stockData=e.data})},r=function(e,a){var i=a?a:0;i+=1,i>1&&(e.lock=!0),e.stepIndex=i;var s=$(".J_step[data-index="+i+"]"),o=1,n=doT.template($("#J_chooseStepTemplate").html());if(s&&s.length>0){if(!e.children)return void s.empty();s.html(n(e)),o=s.find(".J_stepItem[data-index="+i+"]").eq(0).attr("data-node-id"),o=parseInt(o),t.lastStepNum=i,l(e,o,i)}else if(e.children){var r=$("<div>");r.addClass("pro-choose-step J_step"),r.attr("data-index",i),r.html(n(e)),$("#J_proStep").append(r),o=$(".J_stepItem[data-index="+i+"]").eq(0).attr("data-node-id"),o=parseInt(o,10),l(e,o,i)}},l=function(t,e,a){t&&e&&$.each(t.children,function(t,i){return i.node_id===e?(r(i,a),!1):void(i.children&&l(i,e,a))})},c=function(){$(".J_step").off().on("click",".J_stepItem",function(){var e=$(this).hasClass(t.stepLockClass),a=$(this).hasClass(t.stepDisableClass);if(!a&&!e){var i=parseInt($(this).attr("data-node-id")),s=parseInt($(this).attr("data-index")),o=$(this).attr("data-href");$(this).addClass(t.stepActiveClass).siblings().removeClass(t.stepActiveClass);var n=$(this).attr("data-desc")?$(this).attr("data-desc"):"";if($(".J_verDesc[data-index="+s+"]").html(n),o)return $("#J_chooseResultInit").find(".btn").attr("href",o).addClass("btn-primary").removeClass("btn-dakeLight"),void C();$("#J_chooseResultInit").find(".btn").attr("href","javascript:void(0);").addClass("btn-dakeLight").removeClass("btn-primary"),d(s),l(window.chooseConfig.version_data,i,s);var r=s+1,c=$(".J_step[data-index="+r+"]").find(".J_stepItem");c.removeClass(t.stepLockClass),h();var u=$(this).attr("data-gid");u?p($(this)):(_(),v());var f="";C(f);var m=c.not("."+t.stepDisableClass);1===m.length&&setTimeout(function(){c.eq(0).trigger("click")},0)}});var e=$('.J_step[data-index="1"]').find(".J_stepItem");e.hasClass(t.stepDisableClass)||1!==e.length||e.eq(0).trigger("click")},d=function(t){var e=parseInt(t,10),a=0;$(".J_step").each(function(){a=parseInt($(this).attr("data-index"),10),a>e&&$(this).empty()})},p=function(e){if(e&&!(e.length<=0)){var a=e.attr("data-img"),i=e.attr("data-gid"),s=e.attr("data-presales"),o=e.attr("data-presales-status"),n=e.attr("data-presales-url"),r=e.attr("data-openbuy"),l=e.attr("data-openbuy-status"),c=e.attr("data-opensell"),d=e.attr("data-opensell-status"),p=e.attr("data-opensell-url"),u=e.attr("data-href"),m=e.attr("data-fixedlink-url"),g=e.attr("data-fixedlink-txt"),k={};if(k.gid=i,k.presales="1"===s?!0:!1,k.presalesStatus="1"===o?!0:!1,k.presalesUrl=n,k.openbuy="1"===r?!0:!1,k.openbuyStatus="1"===l?!0:!1,k.openSell="1"===c?!0:!1,k.openSellStatus="1"===d?!0:!0,k.openSellUrl=p,m&&g)try{k.fixedlink_url=m,k.fixedlink_txt=g,k.is_fixedlink=!0}catch(C){}if(k.hrefUrl=u,a&&$("#J_proImg").attr("src",a),t.chooseResult=k,k.openSell&&k.openSellStatus||k.presales&&k.presalesStatus||k.is_fixedlink){if(k.openSell&&k.openSellStatus&&t.stockData&&t.stockData[k.gid]){var J=t.stockData[k.gid];if(J&&!J.stock)return _(),k.openSellStatus=!1,void h(k)}t.packageData.length>0?f():h(k)}else _(),v()}},h=function(e){if(e){var a=doT.template($("#J_chooseResuleTemplate").html()),i=a(e);$("#J_chooseResult").html(i).removeClass("hide"),$("#J_chooseResultInit").addClass("hide");var s=$("#J_proBuyBtn").attr("data-gid");t.primaryGoodsId=s,u(s)}else $("#J_chooseResultInit").removeClass("hide"),$("#J_chooseResult").addClass("hide").empty()},u=function(e,a){function i(){var e=MI.GLOBAL_CONFIG.cartSite+"/cart/recommend/goods_id/"+t.primaryGoodsId;t.packageResult&&t.packageResult.pid&&(e+="?package"),location.href=e}function s(e){if(e&&1===e.code)if(a)i();else if(t.packageResult.pid&&t.packageResult.list.length>0){var s=t.packageResult.pid+"-"+t.packageResult.list.join("|");u(s,!0)}else i();else 1!==e.code&&(alert(e.msg),a&&i())}return e?void(a?MI.addShopCart(e,s):MI.bigtapAddCart({obj:"#J_proBuyBtn",callback:s})):!1},f=function(e){var a=doT.template($("#J_packageTemplate").html()),i={},s=0;return i.stepIndex=t.lastStepNum+1,i.packageItem=[],i.lock=e?!0:!1,t.packageData.length<=0?!1:($.each(t.packageData,function(t,a){s=1*(parseFloat(a.market_price)-parseFloat(a.show_price)).toFixed(2),i.packageItem.push({title:a.commodity_name,packageId:a.commodity_id,save_price:s,show_price:a.show_price,lock:e?!0:!1})}),_(),v(),$("#J_proStep").append(a(i)),void $(".J_packageItem").on("click",function(){var e=$(this).attr("data-pid"),a=$(this).hasClass(t.stepActiveClass),i=$(this).hasClass(t.stepLockClass);a||i?($("#J_packageListBox").show(),$("#J_chooseMain").addClass("show-package")):($(this).addClass(t.stepActiveClass).siblings().removeClass(t.stepActiveClass),e?(m(e),t.packageResult.pid=e):v(),h(t.chooseResult),C())}))},m=function(e){if(e){var a=null;if($.each(t.packageData,function(t,i){return i.commodity_id===e?(a=i,!1):void 0}),a){var s=doT.template($("#J_packageListTemplate").html()),o={},n=1*(parseFloat(a.market_price)-parseFloat(a.show_price)).toFixed(2);o.title=a.commodity_name+"－<i>仅"+a.show_price+"元省"+n+"元</i>",o.list=[],$.each(a.list,function(t,e){o.list[t]={versions:[]},1===e.length&&(o.list[t].verHide=!0),$.each(e,function(e,a){0===e&&(o.list[t].goods_name=a.commodity_name,o.list[t].image=a.image),o.list[t].versions.push({image:i(a.image,140),icon:i(a.icon,14),gid:a.goods_id,title:a.commodity_name})})}),v(),$("#J_proStep").after(s(o)).addClass("show-package"),g()}}},g=function(){$(".J_packageListVersions").find(".J_item").on("click",function(){var t=$(this).attr("data-img"),e=$(this).attr("data-title");$(this).addClass("selected").siblings().removeClass("selected"),$(this).parent().siblings(".J_itemImg").find("img").attr({src:t}),$(this).parent().siblings(".J_itemTitle").html(e),k()}),$(".J_packageListVersions").each(function(){$(this).find(".J_item").eq(0).trigger("click")}),k()},v=function(e){e?$("#J_packageListBox").hide():($("#J_packageListBox").remove(),t.packageResult={}),$("#J_chooseMain").removeClass("show-package")},_=function(){$("#J_choosePackage").remove()},k=function(){t.packageResult.list=[],$(".J_packageListVersions").find(".J_item").each(function(){var e=$(this).hasClass("selected");if(e){var a=$(this).attr("data-gid");t.packageResult.list.push(a)}})},C=function(e){var a=t.proFullName;$(".J_stepItem").each(function(){$(this).hasClass("active")&&(a+=" "+$(this).attr("title"))}),e&&(a+=e),$("#J_chooseResultMsg .msg-bd").html(a),$("#J_headerBarDesc").html(a),$(".J_packageItem").each(function(){return $(this).hasClass("active")&&$(this).attr("data-pid")?(a+="<br>"+$(this).attr("title"),$("#J_chooseResultMsg  .msg-bd").html(a),!1):void 0})},J={init:function(){var t=$(".pro-detail-box");$.each(window.chooseConfig.multi_desc,function(e,a){var i;"video"===a.type?(i=doT.template($("#J_multiDescVideo").html()),t.append(i(a.data))):"image"===a.type&&a.data.length?(i=doT.template(1===a.data.length?$("#J_multiDescImage").html():$("#J_multiDescSlider").html()),t.append(i(a.data))):"specs"===a.type?(i=doT.template($("#J_multiDescSpecs").html()),t.append(i(a.data))):"recommend"===a.type&&(i=doT.template($("#J_multiDescRecommend").html()),t.append(i(a.data)))}),this.initialize()},initialize:function(){var t=this;t.slideshow($(".J_slide"),null),t.headerBar(),t.winResize(),this.bindEvt()},bindEvt:function(){var t=this;$(".J_showVideo").on("click",function(){var e=$(this).attr("data-video-url");return e&&t.showVideo(e),!1}),$("#J_showSpec").on("click",function(){$(this).toggleClass("spec-open"),$("#J_specCon").toggleClass("hide")}),$(window).on("resize",function(){t.winResize()}),$("#J_proDetailBox .section").on("visible.visibleWatcher",function(){$(".lazyload",this).each(function(){var t=$(this).attr("data-bg"),e=$(this).attr("data-img");if(t||e){var a=!!t;a?$(this).css("background-image","url("+t+")"):$(this).attr("src",e)}})}),$("#J_proDetailBox .section").visibleWatcher({offset:-300})},showVideo:function(t){var e='<iframe height="348" width="530" src="{{URL}}" frameborder="0" allowfullscreen=""></iframe>';t&&$("#J_showVideo").on("hidden.bs.modal",function(){$(this).find(".modal-body").html("")}).on("show.bs.modal",function(){$(this).find(".modal-body").html(e.replace("{{URL}}",t))}).modal("show")},slideshow:function(t,e){function a(t){i.eq(t).fadeIn(n.duration).siblings().fadeOut(n.duration),n.pager&&s.children(".page").eq(t).addClass("active").siblings().removeClass("active")}var i,s,o,n,r,l=$(t),c="",d='<a class="slide-previous">上一页</a><a class="slide-next">下一页</a>',p=0;return 0===l.length?l:l.length>1?(l.each(function(){J.slideshow($(this),e)}),l):(o={itemSelector:".slide",control:!0,pager:!0,auto:!1,delay:5e3,duration:300},n=$.extend({},o,e),i=l.find(n.itemSelector),i.length<=1?t:(i.wrapAll('<div class="slides-wrapper"></div>'),n.pager&&(c='<div class="pagination">',i.each(function(t){c+='<a class="page" href="javascript: void(0);">'+t+"</a>"}),c+="</div>",s=$(c),l.append(s),s.children(".page").on("click",function(t){t.preventDefault(),p=$(this).index(),a(p)})),n.control&&(l.append($(d)),l.find(".slide-previous").on("click",function(t){t.preventDefault(),p-=1,0>p&&(p=i.length-1),a(p)}),l.find(".slide-next").on("click",function(t){t.preventDefault(),p+=1,p>i.length-1&&(p=0),a(p)})),n.auto&&(r=setInterval(function(){p+=1,p>i.length-1&&(p=0),a(p)},n.delay)),void a(p)))},headerBar:function(){var t=$("#J_proDetailBox").offset().top,e=$("#J_headerBar"),a="header-bar-active";$(window).on("scroll",function(){$(this).scrollTop()>=t?e.addClass(a):e.removeClass(a)}),e.find(".btn").on("click",function(){$("html, body").animate({scrollTop:150},500)})},winResize:function(){var t=$(window).width(),e=$(".J_resizeItem"),a=1260;e.each(function(){var e=$(this).attr("data-src-orig"),i=$(this).attr("data-src-s");a>=t?i&&$(this).attr("src",i):e&&$(this).attr("src",e)})}},w=function(){var t=$(window).height(),e=680;e>=t&&$("#J_proImg").height("80%")},b=function(){a(),J.init(),w()};return{init:b}}(),$(document).ready(function(){MI.buyChoose.init()})},function(t,e){!function(t){function e(e){function a(){for(var e=-1,a=t(document).scrollTop(),i=0,s=c.length;s>i&&a+n.viewport.height()>c[i];i+=1)e+=1;return e}function i(){var e=a();l!==e&&(l=e,r.filter(function(e){return l>=e&&!t(this).hasClass(n.visibleClass)}).addClass(n.visibleClass).trigger("visible.visibleWatcher"),n.onVisible(r.eq(l),l))}function s(){r.each(function(){var e=t(this).attr("data-offset")?Number(t(this).attr("data-offset")):n.offset,a=e%1===0?e:e*n.viewport.height();c.push(t(this).offset().top+a)}),i(),n.onLoad()}var o,n,r=t(this),l=-1,c=[];o={viewport:t(window),visibleClass:"is-visible",offset:300,onLoad:t.noop,onVisible:t.noop},n=t.extend({},o,e),s(),n.viewport.on({"scroll.visibleWatcher":i,"resize.visibleWatcher":s})}t.fn.visibleWatcher=function(t){return e.call(this,t),this}}(jQuery)}]);